<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Engineering Workflow Dashboard</title>
<link rel="stylesheet" href="/css/all.min.css">
<link rel="stylesheet" href="/fonts/inter/inter.css">
    <link rel="stylesheet" href="/styles/workflowdashboard.css">
    <link rel="stylesheet" href="/styles/utils.css">
</head>
<body>
        <% if (usrAdmin) { %>
<!-- Back button -->
    <a href="/adminpage" class="back-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 11H7.83L13.42 5.41L12 4L4 12L12 20L13.41 18.59L7.83 13H20V11Z" fill="currentColor"/>
        </svg>
        Back to Admin
    </a>
<%}%>
    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message">Operation completed successfully</span>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirm Action</h3>
                <button class="close-btn" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <p class="confirmation-text" id="modalText">Are you sure you want to perform this action?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelAction">Cancel</button>
                <button class="btn btn-primary" id="confirmAction">Confirm</button>
            </div>
        </div>
    </div>

    <% if (usrAdmin) { %>
    <div class="container">
        <h1>
            <i class="fas fa-plus-circle"></i>
            Add New Workflow
        </h1>

        <div id="alert-message" class="alert hidden">
            <i class="fas fa-check-circle"></i>
            <span id="alert-text"></span>
        </div>

        <form id="workflow-form">
            <div class="form-group">
                <label for="process-id">Process</label>
                <select id="process-id" class="form-control" required>
                    <option value="">Select Process</option>
                    <% processes.forEach(process => { %>
                        <option value="<%= process.NumberOfProccessID %>"><%= process.ProcessName %></option>
                    <% }) %>
                </select>
            </div>

            <div class="form-group">
                <label for="project-id">Project</label>
                <div style="display: flex; gap: 1rem; align-items: flex-start;">
                    <div style="flex: 1;">
                        <select id="project-id" class="form-control" required>
                            <option value="">Select Project</option>
                            <% projects.forEach(project => { %>
                                <option value="<%= project.projectID %>"><%= project.projectName %></option>
                            <% }) %>
                        </select>
                    </div>
                    <div class="auto-select-toggle" style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.25rem;">
                        <input type="checkbox" id="autoSelectToggle" class="toggle-checkbox">
                        <label for="autoSelectToggle" class="toggle-label" title="Auto-select your login project">Auto</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="package-id">Package</label>
                <select id="package-id" class="form-control" required>
                    <option value="">Select Package</option>
                    <% packages.forEach(pkg => { %>
                        <option value="<%= pkg.PkgeID %>"><%= pkg.PkgeName %></option>
                    <% }) %>
                </select>
            </div>

            <div class="form-group">
                <label>Status</label>
                <div class="status-badge status-pending">
                    <i class="fas fa-clock"></i>
                    Pending
                </div>
                <input type="hidden" id="status" value="Pending">
            </div>

            <div class="button-group">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i>
                    Save Workflow
                </button>
                
            </div>
        </form>
    </div>
    <% } %>

    <!-- Store selected project ID from login -->
    <input type="hidden" id="selectedProjectID" value="<%= locals.projectID %>">

    <div class="dashboard">
        <div class="header">
            <div class="header-top">
                <h1>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 17V19H10V17H3ZM3 5V7H14V5H3ZM14 21V19H21V17H14V15H12V21H14ZM7 9V11H3V13H7V15H9V9H7ZM21 13V11H12V13H21ZM15 9H17V7H21V5H17V3H15V9Z" fill="currentColor"/>
                    </svg>
                    System Engineering Workflow Dashboard
                </h1>
                
                <!-- Floating action button for mobile (hidden on desktop) -->
                <button class="fab" id="mobileAddBtn" title="Add New Workflow">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            
            <div class="toolbar">
                <div class="search-box">
                    <span class="search-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M15.5 14H14.71L14.43 13.73C15.41 12.59 16 11.11 16 9.5C16 5.91 13.09 3 9.5 3C5.91 3 3 5.91 3 9.5C3 13.09 5.91 16 9.5 16C11.11 16 12.59 15.41 13.73 14.43L14 14.71V15.5L19 20.49L20.49 19L15.5 14ZM9.5 14C7.01 14 5 11.99 5 9.5C5 7.01 7.01 5 9.5 5C11.99 5 14 7.01 14 9.5C14 11.99 11.99 14 9.5 14Z" fill="currentColor"/>
                        </svg>
                    </span>
                    <input type="text" id="searchInput" placeholder="Search workflows..." aria-label="Search workflows">
                </div>
            
                <button class="btn btn-outline" id="exportBtn" title="Export to CSV">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M5 20H19V22H5V20ZM12 8C10.3431 8 9 6.65685 9 5C9 3.34315 10.3431 2 12 2C13.6569 2 15 3.34315 15 5C15 6.65685 13.6569 8 12 8ZM12 10C14.2091 10 16 8.20914 16 6C16 3.79086 14.2091 2 12 2C9.79086 2 8 3.79086 8 6C8 8.20914 9.79086 10 12 10ZM6.5 17.5C6.5 14.4624 8.96243 12 12 12C15.0376 12 17.5 14.4624 17.5 17.5H19.5C19.5 13.3579 16.1421 10 12 10C7.85786 10 4.5 13.3579 4.5 17.5H6.5Z" fill="currentColor"/>
                    </svg>
                    Export
                </button>
                <button class="btn btn-outline" id="resetFiltersBtn" title="Reset all filters">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 13H18V11H6V13ZM3 6V8H21V6H3ZM10 18H14V16H10V18Z" fill="currentColor"/>
                    </svg>
                    Reset
                </button>

                <button class="btn btn-outline" id="logoutBtn" title="Logout" data-action="logout">
  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M16 17L21 12L16 7V10H9V14H16V17ZM5 19H13V21H5C3.9 21 3 20.1 3 19V5C3 3.9 3.9 3 5 3H13V5H5V19Z" fill="currentColor"/>
  </svg>
  Logout
</button>

                <% if (isSpecialUser) { %>
                <button class="btn btn-outline" id="addPackageBtn" title="Add Package">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 13H13V19H11V13H5V11H11V5H13V11H19V13Z" fill="currentColor"/>
                  </svg>
                  Add Workflow
                </button>
                <button class="btn btn-outline hidden" id="subpackbtn" title="Sub Package Management">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" fill="currentColor"/>
                  </svg>
                  Add New Package
                </button>
                <% } %>

            </div>
        </div>

        <div class="stats-container" id="statsContainer">
            <!-- Stats will be populated by JavaScript -->
        </div>

        <div class="filters">
            <% if (locals.projectID) { %>
            <div class="filter-group selected-project-display">
                <label class="filter-label">Project</label>
                <div class="selected-project-badge">
                    <i class="fas fa-folder-open"></i>
                    <% const selectedProj = projects.find(p => p.projectID == locals.projectID); %>
                    <span><%= selectedProj ? selectedProj.projectName : 'Unknown Project' %></span>
                </div>
            </div>
            <% } %>

            <div class="filter-group">
                <label class="filter-label" for="processFilter">Process</label>
                <select id="processFilter" aria-label="Filter by process">
                    <option value="">All Processes</option>
                    <% processes.forEach(process => { %>
                        <option value="<%= process.ProcessName %>"><%= process.ProcessName %></option>
                    <% }) %>
                </select>
            </div>

            <div class="filter-group">
                <label class="filter-label" for="statusFilter">Status</label>
                <select id="statusFilter" aria-label="Filter by status">
                    <option value="">All Statuses</option>
                    <option value="Pending">Pending</option>
                    <option value="Completed">Completed</option>
                </select>
            </div>
        </div>

        <div class="table-responsive">
            <div class="table-container">
                <div class="loading" id="loadingIndicator">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Loading workflows...</div>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>
                                <div class="th-inner">
                                    Workflow ID
                                    <span class="sort-icon" data-sort="HdrID" title="Sort by Workflow ID">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M7 10L12 15L17 10H7Z" fill="currentColor"/>
                                        </svg>
                                    </span>
                                </div>
                            </th>
                            <th>
                                <div class="th-inner">
                                    Process
                                    <span class="sort-icon" data-sort="ProcessName" title="Sort by Process">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M7 10L12 15L17 10H7Z" fill="currentColor"/>
                                        </svg>
                                    </span>
                                </div>
                            </th>
                            <th>
                                <div class="th-inner">
                                    Package
                                    <span class="sort-icon" data-sort="PackageName" title="Sort by Package">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M7 10L12 15L17 10H7Z" fill="currentColor"/>
                                        </svg>
                                    </span>
                                </div>
                            </th>
                            <th>
                                <div class="th-inner">
                                    Project
                                    <span class="sort-icon" data-sort="ProjectName" title="Sort by Project">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M7 10L12 15L17 10H7Z" fill="currentColor"/>
                                        </svg>
                                    </span>
                                </div>
                            </th>
                            <th>
                                <div class="th-inner">
                                    Supplier/Contractor
                                    <span class="sort-icon" data-sort="SupplierContractorName" title="Sort by Supplier/Contractor">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M7 10L12 15L17 10H7Z" fill="currentColor"/>
                                        </svg>
                                    </span>
                                </div>
                            </th>
                            <th>
                                <div class="th-inner">
                                    Status
                                    <span class="sort-icon" data-sort="Status" title="Sort by Status">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M7 10L12 15L17 10H7Z" fill="currentColor"/>
                                        </svg>
                                    </span>
                                </div>
                            </th>
                            <th>
                                <div class="th-inner">
                                    Created Date
                                    <span class="sort-icon" data-sort="createdDate" title="Sort by Created Date">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M7 10L12 15L17 10H7Z" fill="currentColor"/>
                                        </svg>
                                    </span>
                                </div>
                            </th>
  
                            <th>
                                <div class="th-inner">
                                    Start Date
                                    <span class="sort-icon" data-sort="startDate" title="Sort by Start Date">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M7 10L12 15L17 10H7Z" fill="currentColor"/>
                                        </svg>
                                    </span>
                                </div>
                            </th>

                            <th>
                                <div class="th-inner">
                                    Finished Date
                                    <span class="sort-icon" data-sort="completionDate" title="Sort by Finished Date">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M7 10L12 15L17 10H7Z" fill="currentColor"/>
                                        </svg>
                                    </span>
                                </div>
                            </th>

                                <th>
                                <div class="th-inner">
                                    Days Taken
                                    <span class="sort-icon" data-sort="startDate" title="Sort by Start Date">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M7 10L12 15L17 10H7Z" fill="currentColor"/>
                                        </svg>
                                    </span>
                                </div>
                            </th>
                          
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="workflowTableBody">
                        <!-- Table content will be populated by JavaScript -->
                    </tbody>
                </table>

                <div class="no-results" id="noResultsMessage">
                    <div class="no-results-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20ZM13 17H11V15H13V17ZM13 13H11V7H13V13Z" fill="currentColor"/>
                        </svg>
                    </div>
                    <p id="noResultsText">No workflows match your search criteria</p>
                    <button class="btn btn-outline" id="resetNoResultsBtn">Reset Filters</button>
                </div>
            </div>
        </div>

        <div class="pagination">
            <div class="page-info" id="pageInfo">Showing 0 to 0 of 0 entries</div>
            <div class="page-controls" id="paginationControls">
                <!-- Pagination buttons will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Floating action button for mobile -->
    <button class="fab hidden" id="mobileAddBtnBottom" title="Add New Workflow">
        <i class="fas fa-plus"></i>
    </button>

<script src="/js/workflowdashboard.js"></script>
</body>
</html>